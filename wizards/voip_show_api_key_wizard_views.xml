<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- Show API Key Wizard Form -->
        <record id="view_voip_show_api_key_wizard_form" model="ir.ui.view">
            <field name="name">voip.show.api.key.wizard.form</field>
            <field name="model">voip.show.api.key.wizard</field>
            <field name="arch" type="xml">
                <form string="API Key Details">
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="server_name" readonly="1"/>
                            </h1>
                        </div>
                        
                        <group colspan="4">
                            <group string="Server Information">
                                <field name="server_id" invisible="1"/>
                                <field name="websocket_url" readonly="1" widget="url"/>
                            </group>
                            <group string="Webhook Configuration">
                                <label for="webhook_url" string="Webhook URL"/>
                                <div class="o_row">
                                    <field name="webhook_url" readonly="1" class="oe_inline" style="width: 80%;"/>
                                    <button name="action_copy_webhook_url" 
                                            type="object" 
                                            icon="fa-clipboard" 
                                            title="Copy Webhook URL"
                                            class="btn-link"/>
                                </div>
                            </group>
                        </group>
                        
                        <group colspan="4" col="1">
                            <group string="API Key (Visible)">
                                <label for="api_key" string="API Key"/>
                                <div class="o_row">
                                    <field name="api_key" 
                                           readonly="1" 
                                           class="oe_inline font-monospace text-primary" 
                                           style="width: 80%; font-size: 14px; font-weight: bold;"/>
                                    <button name="action_copy_api_key" 
                                            type="object" 
                                            icon="fa-clipboard" 
                                            title="Copy API Key"
                                            class="btn-link"/>
                                </div>
                            </group>
                        </group>
                        
                        <div class="alert alert-info" role="alert">
                            <i class="fa fa-info-circle" title="Information"/>
                            <strong>Important:</strong> Keep this API key secure. Use it in the X-API-Key header when calling the webhook endpoint from FreePBX.
                        </div>

                        <div class="alert alert-warning" role="alert">
                            <i class="fa fa-terminal" title="Terminal Command"/>
                            <strong>Example cURL command:</strong>
                            <pre style="background: #f5f5f5; padding: 10px; border-radius: 5px; margin-top: 10px;">curl -X POST <field name="webhook_url" readonly="1" nolabel="1" class="d-inline"/> \
-H "Content-Type: application/json" \
-H "X-API-Key: <field name="api_key" readonly="1" nolabel="1" class="d-inline"/>" \
-d '{"event_type":"Test","timestamp":"2025-10-22T12:00:00","data":{}}'</pre>
                        </div>


                    </sheet>
                    <footer>
                        <button string="Close" class="btn-secondary" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>
        
        <!-- Action to open wizard -->
        <record id="action_show_api_key" model="ir.actions.act_window">
            <field name="name">Show API Key</field>
            <field name="res_model">voip.show.api.key.wizard</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
            <field name="context">{'default_server_id': active_id}</field>
        </record>
        
    </data>
</odoo>

